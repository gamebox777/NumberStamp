# NumberStamp 要件定義書

## 1. プロジェクト概要

| 項目 | 内容 |
| :--- | :--- |
| **アプリ名** | NumberStamp |
| **バージョン** | 1.5.0 |
| **概要** | 画像に連番スタンプ・矩形・テキスト・ペン・矢印等の注釈を配置し、作業手順書やバグ報告、レビュー画像などを素早く作成するためのWebアプリケーション |
| **種別** | SPA (Single Page Application) |
| **デプロイ先** | Vercel (https://number-stamp.vercel.app/) |

---

## 2. 技術スタック

| カテゴリ | 技術 | バージョン |
| :--- | :--- | :--- |
| ランタイム | Node.js | v18以上推奨 |
| ビルドツール | Vite | ^7.3.1 |
| UIフレームワーク | React | ^19.2.0 |
| キャンバス描画 | Konva / react-konva | ^10.2.0 / ^19.2.2 |
| アイコン | lucide-react | ^0.564.0 |
| カラーピッカー | react-colorful | ^5.6.1 |
| 画像読み込み | use-image | ^1.1.4 |
| UUID生成 | uuid | ^13.0.0 |
| テスト/スクリーンショット | Playwright | ^1.58.2 |

---

## 3. ターゲットユーザー

- 作業手順書を作成するエンジニア・テクニカルライター
- バグ報告画像を作成するQAエンジニア
- デザインレビューにコメントを付けるデザイナー・開発者
- 簡易的な画像注釈を必要とする一般ユーザー

---

## 4. 動作環境

| 項目 | 要件 |
| :--- | :--- |
| ブラウザ | モダンブラウザ (Chrome, Firefox, Edge, Safari の最新版) |
| デバイス | PC (デスクトップ/ノートPC) |
| インターネット | 初回ロード時のみ必要（オフラインでも動作可能なSPA） |

---

## 5. 画面構成

### 5.1 レイアウト

アプリケーションは3つの主要エリアで構成される。

```
┌──────────────────────────────────────────────┐
│  ツールバー  │      キャンバスエリア        │ 設定パネル │
│  (左サイド)  │      (中央メイン)            │ (右サイド)  │
│   60px固定   │       flex:1               │  280px     │
│              │                             │ 折り畳み可  │
└──────────────────────────────────────────────┘
```

| エリア | 幅 | 説明 |
| :--- | :--- | :--- |
| ツールバー | 60px固定 | ツール選択、Undo/Redo、ファイル操作ボタン群 |
| キャンバスエリア | 可変 (flex:1) | 背景画像表示・注釈オブジェクト描画エリア |
| 設定パネル (右サイドバー) | 280px (折り畳み時 30px) | 選択中ツール/オブジェクトの詳細設定 |

### 5.2 追加UI要素

| 要素 | 説明 |
| :--- | :--- |
| 画像情報バー | キャンバス左下に画像ファイル名・解像度を半透明表示 |
| バナー | 設定パネル下部にアプリバナー・バージョン情報を表示 |
| コンテキストメニュー | 右クリックでコピー・ペースト・削除メニューを表示 |
| ツールチップ | 各ボタンにホバー時のヒント表示 |

---

## 6. 機能要件

### 6.1 画像読み込み機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| IMG-001 | ツールバーの画像アイコンからファイル選択ダイアログで画像を読み込めること | 必須 |
| IMG-002 | ウィンドウへのドラッグ＆ドロップで画像を読み込めること | 必須 |
| IMG-003 | 画像読み込み時、キャンバスサイズが画像サイズに自動調整されること | 必須 |
| IMG-004 | 画像読み込み時、既存のアイテムがリセットされること | 必須 |
| IMG-005 | 対応フォーマット：ブラウザが `image/*` として認識する全画像形式 | 必須 |

### 6.2 ツールモード

アプリケーションは以下の6つのツールモードを持つ。モードはツールバーで切り替え、切り替え時に選択状態が解除される。

#### 6.2.1 選択 (Select) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| SEL-001 | オブジェクトをクリックして選択できること | 必須 |
| SEL-002 | 選択中のオブジェクトをドラッグして移動できること | 必須 |
| SEL-003 | `Ctrl`/`Cmd` + クリックで複数選択できること | 必須 |
| SEL-004 | 何もない場所からドラッグして範囲選択(矩形選択)ができること | 必須 |
| SEL-005 | 選択中のオブジェクトに Transformer (リサイズハンドル) が表示されること | 必須 |
| SEL-006 | 右クリックでオブジェクトを選択状態にできること | 必須 |

#### 6.2.2 スタンプ (Stamp) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| STP-001 | キャンバスクリック位置に連番スタンプを配置できること | 必須 |
| STP-002 | 配置ごとに番号が設定された増分 (Step) に従い自動インクリメントすること | 必須 |
| STP-003 | 形状を「円 (Circle)」「角丸四角 (Square)」から選択できること | 必須 |
| STP-004 | 形状サイズ (radius) を設定できること | 必須 |
| STP-005 | 文字サイズ (stampFontSize) を個別に設定できること | 必須 |
| STP-006 | 形状色と文字色を個別に設定できること | 必須 |
| STP-007 | フォントサイズを形状サイズに同期するオプション (stampSyncFontSize) があること | 必須 |
| STP-008 | スタンプ間を矢印で接続 (Connect) できること。選択モードでハンドルをドラッグして接続する | 必須 |

#### 6.2.3 矩形 (Rectangle) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| RCT-001 | ドラッグ操作で矩形を描画できること | 必須 |
| RCT-002 | 枠線の色・太さを設定できること | 必須 |
| RCT-003 | 塗りつぶし色 (fill) を設定できること (透明含む) | 必須 |
| RCT-004 | 矩形内にテキストを入力・表示できること | 必須 |
| RCT-005 | テキストのフォントサイズ・フォントファミリー・色を設定できること | 必須 |
| RCT-006 | テキストの水平配置 (left/center/right) を設定できること | 必須 |
| RCT-007 | テキストの垂直配置 (top/middle/bottom) を設定できること | 必須 |
| RCT-008 | テキストの折り返し (wrap) の有無を設定できること | 必須 |

#### 6.2.4 テキスト (Text) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| TXT-001 | クリック位置にテキストオブジェクトを配置できること | 必須 |
| TXT-002 | テキスト内容を設定パネルから編集できること | 必須 |
| TXT-003 | フォントサイズ・色・フォントファミリーを設定できること | 必須 |

#### 6.2.5 ペン (Pen) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| PEN-001 | ドラッグ操作でフリーハンドの線を描画できること | 必須 |
| PEN-002 | 線の色を設定できること | 必須 |
| PEN-003 | 線の太さを設定できること | 必須 |

#### 6.2.6 直線・矢印 (Line/Arrow) モード

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| LIN-001 | ドラッグ操作で直線を描画できること | 必須 |
| LIN-002 | 線の色・太さを設定できること | 必須 |
| LIN-003 | 始点・終点それぞれに矢印の有無を設定できること | 必須 |
| LIN-004 | 選択時に始点・終点のハンドルが表示され、位置を調整できること | 必須 |

### 6.3 編集機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| EDT-001 | Undo (元に戻す) 機能：`Ctrl+Z` / `Cmd+Z` | 必須 |
| EDT-002 | Redo (やり直し) 機能：`Ctrl+Y` / `Cmd+Shift+Z` | 必須 |
| EDT-003 | コピー機能：`Ctrl+C` / `Cmd+C` | 必須 |
| EDT-004 | ペースト機能：`Ctrl+V` / `Cmd+V` (20pxオフセット) | 必須 |
| EDT-005 | 削除機能：`Delete` / `Backspace` キー | 必須 |
| EDT-006 | 右クリックメニューからのコピー・ペースト・削除 | 必須 |
| EDT-007 | 右クリックメニューからのペースト時、クリック位置に配置されること | 必須 |
| EDT-008 | 複数オブジェクトの一括移動・削除が可能であること | 必須 |
| EDT-009 | Undo/Redo の履歴管理 (past/present/future スタック方式) | 必須 |

### 6.4 設定パネル機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| SET-001 | プロジェクト名を設定・編集できること | 必須 |
| SET-002 | 選択中のツールに応じて対応する設定項目が表示されること | 必須 |
| SET-003 | 選択中のオブジェクトのプロパティを編集できること | 必須 |
| SET-004 | カラーピッカー：プリセットカラー10色から選択できること | 必須 |
| SET-005 | カラーピッカー：フリーカラーピッカー (RGBAスライダー) で任意の色を選択できること | 必須 |
| SET-006 | カラーピッカー：直近5色の使用履歴を表示・再選択できること | 必須 |
| SET-007 | カラーピッカー：透明度 (Alpha) を設定できること | 必須 |
| SET-008 | 設定パネルを折り畳み/展開できること | 必須 |
| SET-009 | デフォルト値にリセットする機能があること | 必須 |

### 6.5 ズーム機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| ZOM-001 | スライダーでズーム倍率を変更できること (10%〜300%) | 必須 |
| ZOM-002 | +/- ボタンで10%刻みの増減ができること | 必須 |
| ZOM-003 | 1:1 ボタンで等倍表示にリセットできること | 必須 |
| ZOM-004 | 現在のズーム倍率がパーセント表示されること | 必須 |

### 6.6 保存・書き出し機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| SAV-001 | 画像エクスポート：PNG形式で保存できること | 必須 |
| SAV-002 | 画像エクスポート：JPG形式で保存できること | 必須 |
| SAV-003 | 画像エクスポート：pixelRatio:2 の高解像度で書き出すこと | 必須 |
| SAV-004 | 画像エクスポート時、選択枠が含まれないこと (一時的に選択解除) | 必須 |
| SAV-005 | プロジェクト保存：JSON形式で全状態を保存できること | 必須 |
| SAV-006 | プロジェクト保存：プロジェクト名、アイテム一覧、画像、サイズ、設定を含むこと | 必須 |
| SAV-007 | プロジェクト読み込み：JSONファイルから状態を復元できること | 必須 |
| SAV-008 | プロジェクト名バリデーション：小文字英数字・ドット・アンダースコア・ハイフンのみ許可 | 必須 |
| SAV-009 | プロジェクト名バリデーション：100文字以内制限 | 必須 |
| SAV-010 | プロジェクト名バリデーション：`---` を含む名前は禁止 | 必須 |
| SAV-011 | ブラウザのダウンロード履歴に残る方式で保存すること | 必須 |

### 6.7 全削除 (Clear All) 機能

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| CLR-001 | 確認ダイアログを表示後、全アイテムと画像をクリアできること | 必須 |
| CLR-002 | クリア時にプロジェクト名を `untitled-project` にリセットすること | 必須 |
| CLR-003 | クリア時にスタンプ番号を1にリセットすること | 必須 |

---

## 7. 非機能要件

| ID | 要件 | 優先度 |
| :--- | :--- | :--- |
| NFR-001 | SPA構成であること（ページ遷移なし） | 必須 |
| NFR-002 | サーバーサイド処理不要（全てクライアントサイドで完結） | 必須 |
| NFR-003 | 外部サーバーへのデータ送信を行わないこと（プライバシー保護） | 必須 |
| NFR-004 | ErrorBoundary によるエラーハンドリングがあること | 必須 |
| NFR-005 | レスポンシブ対応（ビューポート全体を使用する flexbox レイアウト） | 必須 |
| NFR-006 | Vercel での静的ホスティングに対応すること | 必須 |

---

## 8. データモデル

### 8.1 プロジェクトデータ構造 (JSON)

```json
{
  "projectName": "string",
  "items": [ /* アイテム配列 */ ],
  "imageSrc": "string (DataURL)",
  "imageSize": { "width": "number", "height": "number" },
  "settings": { /* 設定オブジェクト */ },
  "version": "string"
}
```

### 8.2 アイテム共通プロパティ

| プロパティ | 型 | 説明 |
| :--- | :--- | :--- |
| id | string (UUID) | 一意識別子 |
| type | string | `stamp` / `rectangle` / `text` / `pen` / `line` |
| x | number | X座標 |
| y | number | Y座標 |

### 8.3 アイテムタイプ別プロパティ

#### Stamp

| プロパティ | 型 | デフォルト | 説明 |
| :--- | :--- | :--- | :--- |
| number | number | 1 | 表示番号 |
| radius | number | 20 | 形状サイズ |
| shape | string | `circle` | 形状 (`circle` / `square`) |
| color | string | `rgba(255,0,0,1)` | 形状色 |
| stampFontSize | number | 24 | 文字サイズ |
| stampTextColor | string | `#FFFFFF` | 文字色 |
| stampSyncFontSize | boolean | true | フォントサイズ同期フラグ |

#### Rectangle

| プロパティ | 型 | デフォルト | 説明 |
| :--- | :--- | :--- | :--- |
| width | number | - | 幅 |
| height | number | - | 高さ |
| strokeWidth | number | 5 | 枠線太さ |
| color | string | `red` | 枠線色 |
| fill | string | `transparent` | 塗りつぶし色 |
| rectText | string | (空文字) | テキスト内容 |
| fontSize | number | 24 | テキストフォントサイズ |
| fontFamily | string | `Arial` | テキストフォントファミリー |
| textColor | string | `#000000` | テキスト色 |
| align | string | `center` | 水平配置 |
| verticalAlign | string | `middle` | 垂直配置 |
| wrap | string | `none` | テキスト折り返し |

#### Text

| プロパティ | 型 | デフォルト | 説明 |
| :--- | :--- | :--- | :--- |
| text | string | `Text` | テキスト内容 |
| fontSize | number | 24 | フォントサイズ |
| fontFamily | string | `Arial` | フォントファミリー |
| fill | string | `#000000` | テキスト色 |

#### Pen

| プロパティ | 型 | デフォルト | 説明 |
| :--- | :--- | :--- | :--- |
| points | number[] | - | ポイント座標列 |
| color | string | `red` | 線色 |
| strokeWidth | number | 5 | 線太さ |

#### Line

| プロパティ | 型 | デフォルト | 説明 |
| :--- | :--- | :--- | :--- |
| points | number[] | - | [始点X, 始点Y, 終点X, 終点Y] |
| color | string | `#FF0000` | 線色 |
| strokeWidth | number | 5 | 線太さ |
| startArrow | boolean | false | 始点矢印の有無 |
| endArrow | boolean | true | 終点矢印の有無 |

---

## 9. コンポーネント構成

```
App.jsx                     # メインアプリケーション / 状態管理
├── Toolbar.jsx             # 左サイドバー: ツール選択・ファイル操作
├── CanvasArea.jsx          # 中央: Konva Stage / 描画エリア
│   ├── StampItem.jsx       # スタンプオブジェクト描画
│   ├── RectangleItem.jsx   # 矩形オブジェクト描画
│   ├── TextItem.jsx        # テキストオブジェクト描画
│   ├── PenItem.jsx         # ペンストローク描画
│   ├── LineItem.jsx        # 直線/矢印描画
│   └── ArrowItem.jsx       # スタンプ間矢印描画
├── SettingsPanel.jsx       # 右サイドバー: 設定パネル
│   └── ColorPickerPopover  # カラーピッカーポップオーバー
├── ContextMenu.jsx         # 右クリックコンテキストメニュー
├── Tooltip.jsx             # ツールチップ
└── ErrorBoundary.jsx       # エラーバウンダリ

hooks/
└── useUndoRedo.js          # Undo/Redo カスタムフック

utils/
└── validation.js           # プロジェクト名バリデーション

constants/
└── defaults.js             # デフォルトスタイル定義
```

---

## 10. 更新履歴

| 日付 | バージョン | 変更内容 |
| :--- | :--- | :--- |
| 2026-02-19 | 1.0 | 初版作成（コードベース v1.5.0 に基づく要件定義） |
